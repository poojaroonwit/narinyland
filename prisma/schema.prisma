generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model AppConfig {
  id              String   @id @default("default")
  appName         String   @default("Narinyland")
  anniversaryDate DateTime @default(now())
  treeStyle       String   @default("sakura")
  galleryStyle    String   @default("carousel")
  gallerySource   String   @default("manual") // "manual" | "instagram"
  instagramUsername String  @default("")
  daysPerTree     Int      @default(100)
  daysPerFlower   Int      @default(7)
  flowerType      String   @default("sunflower")
  mixedFlowers    String[] @default(["sunflower", "tulip", "rose", "cherry", "lavender", "heart"])
  skyMode         String   @default("follow_timezone") // "follow_timezone" | "noon" | "night"
  timelineDefaultRows Int  @default(5)
  musicUrl        String   @default("https://www.youtube.com/watch?v=5qap5aO4i9A")
  proposalQuestions String[] @default(["Will you be my Valentine?", "Jaroonwit is so handsome, right?"])
  isProposalAccepted Boolean  @default(false)
  proposalProgress   Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  partners Partner[]
  coupons  Coupon[]
}

model Partner {
  id        String    @id @default(uuid())
  partnerId String    
  name      String
  avatar    String
  config    AppConfig @relation(fields: [configId], references: [id], onDelete: Cascade)
  configId  String
  points    Int       @default(0)
  lifetimePoints Int  @default(0)
  sentLetters LoveLetter[] @relation("SentLetters")
  @@unique([configId, partnerId])
}

model Memory {
  id        String   @id @default(uuid())
  url       String   
  s3Key     String?  
  privacy   String   @default("public")
  caption   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TimelineEvent {
  id        String   @id @default(uuid())
  text      String
  type      String   
  location  String?
  timestamp DateTime
  mediaType String?   
  mediaUrl  String?   
  mediaS3Key String?  
  mediaUrls   String[] @default([])
  mediaTypes  String[] @default([])
  mediaS3Keys String[] @default([])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LoveLetter {
  id         String   @id @default(uuid())
  content    String
  from       Partner  @relation("SentLetters", fields: [fromId], references: [id], onDelete: Cascade)
  fromId     String
  unlockDate DateTime
  isRead     Boolean  @default(false)
  mediaType  String?  
  mediaUrl   String?
  mediaS3Key String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Coupon {
  id        String    @id @default(uuid())
  title     String
  emoji     String
  desc      String
  color     String
  points    Int       @default(0)
  forPartner String   
  isRedeemed Boolean  @default(false)
  redeemedAt DateTime?
  config    AppConfig @relation(fields: [configId], references: [id], onDelete: Cascade)
  configId  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model LoveStats {
  id              String @id @default("default")
  xp              Int    @default(0)
  level           Int    @default(1)
  questsCompleted Int    @default(0)
  leaves          Int    @default(0)
  points          Int    @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model QuestLog {
  id          String   @id @default(uuid())
  questText   String
  completedBy String?  
  completedAt DateTime @default(now())
}
